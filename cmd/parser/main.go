package main

import (
	"encoding/json"
	"fmt"
	"github.com/devrdn/wp-vulnerability-parser/internal/models"
	_ "github.com/mattn/go-sqlite3"
	"log"
	"os"
	"strconv"
)

func main() {
	var vulnerabilities []*models.Vulnerability

	for i := 1; i <= 5; i++ {
		vul, err := Parse("https://www.wordfence.com/threat-intel/vulnerabilities/search?page=" + strconv.Itoa(i))
		if err != nil {
			return
		}
		vulnerabilities = append(vulnerabilities, vul...)
		fmt.Println(vulnerabilities)
	}

	jsonData, err := json.Marshal(vulnerabilities)

	if err != nil {
		log.Fatal(err)
		return
	}

	file, err := os.Create("vul.json")
	if err != nil {
		log.Fatal(err)
		return
	}
	defer file.Close()

	file.Write(jsonData)
}
